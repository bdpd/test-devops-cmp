---
  - name: Install and Start docker
    hosts: webserver
    connection: ssh
    remote_user: ec2-user
    become: yes
    become_user: root
    gather_facts: False
    tags: provisioning
    
    tasks:
      - yum:
          name: "{{ item }}"
          state: absent
        with_items:
          - docker
          - docker-common
          - container-selinux
          - docker-selinux
          - docker-engine

      - yum:
          name: python-setuptools
          state: present
          update_cache: true

      - name: Prerequisites
        yum: 
          name: "{{ item }}"
          update_cache: yes 
        with_items:
          - yum-utils 
          - device-mapper-persistent-data 
          - lvm2

      - name: Add the repo
        command: yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo 
   
      - name: Update Yum package index 
        command: yum makecache fast

      - name: Install the thing. Check here https://github.com/moby/moby/issues/33930 
        yum: 
          name: "{{ item }}" 
          state: present
        with_items:
          - docker-ce
          - docker-ce-selinux 
